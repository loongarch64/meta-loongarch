From bdef125c9692d51be45e74233dc7dd5109baff0d Mon Sep 17 00:00:00 2001
From: CaoHuixiong <caohuixiong@loongson.cn>
Date: Sat, 19 Oct 2019 05:00:36 +0000
Subject: [PATCH] complie isohybrid for loongson

---
 utils/Makefile | 10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)

diff --git a/utils/Makefile b/utils/Makefile
index b103124..d6dc216 100644
--- a/utils/Makefile
+++ b/utils/Makefile
@@ -15,11 +15,12 @@
 #
 
 VPATH = $(SRC)
-include $(MAKEDIR)/syslinux.mk
+#include $(MAKEDIR)/syslinux.mk
+UMAKEDEPS = -MT $@ -MMD -MF $(dir $@).$(notdir $@).d
 
 CC_FOR_BUILD ?= $(CC)
 
-CFLAGS   = $(CFLAGS_FOR_BUILD) $(GCCWARN) -Os -fomit-frame-pointer -D_FILE_OFFSET_BITS=64 -I$(SRC)
+CFLAGS   = $(CFLAGS_FOR_BUILD) $(GCCWARN) -Os -D_FILE_OFFSET_BITS=64
 LDFLAGS  = $(LDFLAGS_FOR_BUILD) -O2
 
 C_TARGETS	 = isohybrid gethostip memdiskfind
@@ -34,6 +35,9 @@ ISOHDPFX = $(addprefix $(OBJ)/,../mbr/isohdpfx.bin ../mbr/isohdpfx_f.bin \
 	   ../mbr/isohdpfx_c.bin \
 	   ../mbr/isohdppx.bin ../mbr/isohdppx_f.bin ../mbr/isohdppx_c.bin)
 
+ISOHDPFX = isohdpfx.bin isohdpfx_f.bin \
+	   isohdpfx_c.bin \
+	   isohdppx.bin isohdppx_f.bin isohdppx_c.bin
 all: $(TARGETS)
 
 %.o: %.c
@@ -50,7 +54,7 @@ isohybrid.pl: isohybrid.in $(ISOHDPFX) bin2hex.pl
 	chmod a+x $@
 
 isohdpfx.c: $(ISOHDPFX) isohdpfxarray.pl
-	$(PERL) $(SRC)/isohdpfxarray.pl $(ISOHDPFX) > $@
+	perl ./isohdpfxarray.pl $(ISOHDPFX) > $@
 
 isohybrid: isohybrid.o isohdpfx.o
 	$(CC_FOR_BUILD) $(LDFLAGS) -o $@ $^ -luuid
-- 
2.1.0

